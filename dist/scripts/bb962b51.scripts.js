"use strict";angular.module("SpencerApplegateBlog",["SpencerApplegateBlog.services","SpencerApplegateBlog.controllers","SpencerApplegateBlog.filters"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/about.html",controller:"AboutCtrl",activeTab:"about"}),a.when("/login",{templateUrl:"views/login.html",controller:"LoginCtrl",activeTab:"about"}),a.when("/blog",{templateUrl:"views/blog/list.html",controller:"BlogCtrl",activeTab:"blog",resolve:{load:["Post",function(a){return a.query()}]}}),a.when("/blog/new/",{templateUrl:"views/blog/detail.html",controller:"CreateCtrl",activeTab:"blog"}),a.when("/blog/:id",{templateUrl:"views/blog/view.html",controller:"ViewCtrl",activeTab:"blog",resolve:{load:["$route","Post",function(a,b){return b.get({id:a.current.pathParams.id}).then(function(a){return a.comments=_.map(a.comments,function(a){return a}),a})}]}}),a.when("/blog/:postId/comments/new",{templateUrl:"views/blog/comments/detail.html",controller:"CreateCommentCtrl",activeTab:"blog"}),a.when("/blog/edit/:id",{templateUrl:"views/blog/detail.html",controller:"EditCtrl",activeTab:"blog"}),a.when("/contact",{templateUrl:"views/contact.html",controller:"ContactCtrl",activeTab:"contact"}),a.otherwise({redirectTo:"/"})}]),angular.module("SpencerApplegateBlog.controllers",["ngCookies"]).controller("NavCtrl",["$scope","$route",function(a,b){a.$route=b}]).controller("AboutCtrl",["$scope","$location","$cookies","Login",function(a,b,c,d){a.logout=function(){d.logout(function(){b.path("/")})}}]).controller("BlogCtrl",["$scope","$location","load",function(a,b,c){a.posts=c,a.view=function(a){b.path("/blog/"+a)}}]).controller("CreateCtrl",["$scope","$location","Post",function(a,b,c){a.save=function(){c.save(a.post,function(){b.path("/blog")})}}]).controller("EditCtrl",["$scope","$routeParams","$location","Post",function(a,b,c,d){var e=this;d.get({id:b.id}).then(function(b){e.original=b,a.post=new d(e.original)}),a.isClean=function(){return angular.equals(e.original,a.post)},a.save=function(){a.post.update(function(){c.path("/blog")})},a.destroy=function(){e.original.destroy(function(){c.path("/blog")})}}]).controller("ViewCtrl",["$scope","$location","$routeParams","load","Comment","Post",function(a,b,c,d,e,f){a.post=d,a.destroy=function(b){e.remove({id:b},function(){f.get({id:c.id}).then(function(b){a.post.comments=_.map(b.comments,function(a){return a})})})}}]).controller("CreateCommentCtrl",["$scope","$location","$routeParams","Comment",function(a,b,c,d){a.save=function(){a.comment.timestamp=new Date,a.comment.postId=c.postId,a.comment.parentId="",d.save(a.comment,function(){b.path("/blog/"+c.postId)})}}]).controller("ContactCtrl",["$scope",function(){}]).controller("LoginCtrl",["$scope","$location","Login",function(a,b,c){a.save=function(){var d={email:a.email,password:a.password};c.login(d,function(){b.path("/")})}}]),angular.module("SpencerApplegateBlog.services",["ngResource","ngCookies"]).factory("Post",["$http","$q","_api",function(a,b,c){var d=function(a){angular.extend(this,a)};return d.query=function(){var d=b.defer();return a({method:"GET",url:c+"/posts/"}).success(function(a){a=_.map(a,function(a){var b=a.id.toString().substring(0,8);return a.timestamp=new Date(1e3*parseInt(b,16)),a}),d.resolve(a)}).error(function(){d.reject()}),d.promise},d.get=function(e){var f=b.defer();return a({method:"GET",url:c+"/posts/"+e.id}).success(function(a){f.resolve(new d(a))}).error(function(){f.reject()}),f.promise},d.save=function(b,d){a({method:"POST",url:c+"/posts",data:b}).success(d).error(function(){console.log("There was an error creating your post")})},d.update=function(b,d,e){a({method:"PUT",url:c+"/posts/"+b.id,data:d}).success(e).error(function(){console.log("There was an error saving your post")})},d.remove=function(b,d){a({method:"DELETE",url:c+"/posts/"+b.id}).success(d).error(function(){console.log("There was an error deleting your post")})},d.prototype.update=function(a){return d.update({id:this.id},this,a)},d.prototype.destroy=function(a){return d.remove({id:this.id},a)},d}]).factory("Comment",["$http","$q","_api",function(a,b,c){var d=function(a){angular.extend(this,a)};return d.save=function(b,d){a({method:"POST",url:c+"/comments",data:b}).success(d).error(function(){console.log("There was an error saving the comment")})},d.remove=function(b,d){a({method:"DELETE",url:c+"/comments/"+b.id,withCredentials:!0}).success(d).error(function(){console.log("There was an error deleting the comment")})},d.prototype.destroy=function(a){return d.remove({id:this.id},a)},d}]).factory("Login",["$http","$cookies","_api",function(a,b,c){var d=function(a){angular.extend(this,a)};return d.login=function(b,d){a({method:"POST",url:c+"/auth/login/",data:angular.toJson(b),withCredentials:!0}).success(function(a,b,c){console.log(c("")),d()}).error(function(){console.log("There was an error logging in")})},d.logout=function(b){a({method:"GET",url:c+"/auth/logout/"}).success(function(a){console.log(a),b()}).error(function(){console.log("There was an error logging out")})},d}]).value("version","0.1").value("_api","http://dev.maasive.net/SuperSpock/spencer"),angular.module("SpencerApplegateBlog.filters",[]).filter("interpolate",["version",function(a){return function(b){return String(b).replace(/\%VERSION\%/gm,a)}}]).filter("reverse",[function(){return function(a){return a.slice().reverse()}}]).filter("comment",[function(){return function(a,b){return _.filter(a,function(a){return a.postId==b})}}]),angular.module("SpencerApplegateBlog.directives",[]).directive("appVersion",["version",function(a){return function(b,c){c.text(a)}}]),angular.module("SpencerApplegateBlog.mockBackend",["ngMockE2E"]).run(["$httpBackend",function(a){function b(){for(var a=16,b="0123456789abcdefghijklmnopqrstuvwxyz",c="",d=Date.parse((new Date).toString())/1e3,e=d.toString(16),f=a;f>0;--f)c+=b[Math.round(Math.random()*(b.length-1))];return e+c}function c(a){for(var b in h){var c=h[b];for(var d in c)c.hasOwnProperty(d)&&d==a&&delete c[d]}}var d=function(a,b,c,d){this.tags=[],this.text=d,this.title=c,this.commentId=b,this.email="spencer.applegate3@gmail.com",this.version=1,this._links={},this._links.relative={},this._links.absolute={},this._links.relative.api="/"+a+"/",this._links.relative.document=a+"/",this._links.absolute="http://dev.maasive.net/SuperSpock/spencer/posts/"+a+"/",this.id=a,this.timestamp=Date.now()},e=function(a,b,c,d,e){this.tags=[],this.text=e,this.email=d,this.version=1,this._links={},this._links.relative={},this._links.absolute={},this._links.relative.api="/"+a+"/",this._links.relative.document=a+"/",this._links.absolute="http://dev.maasive.net/SuperSpock/spencer/comments/"+a+"/",this.parentId=b,this.postId=c,this.id=a,this.timestamp=Date.now()},f={},g="51b7b443wmsciv3sgifciqo2";f[g]=new d(g,g,"This is a title","This is a body");var h={},i="51b7b4bc8lycn8qgcib4bb49",j="51b7b4bc8lycn8qgcib4cc5x";h[g]={},h[g][i]=new e(i,"",g,"spencer.applegate3@gmail.com","whatt?"),h[g][j]=new e(j,"",g,"spencer.applegate3@gmail.com","whatt, 2?"),a.whenGET("/posts").respond(function(){return[200,f]}),a.whenGET(/\/posts(\/[0-9a-z]{24})/).respond(function(a,b){var c=b.replace("/posts","").split("/"),d=c[1],e=f[d],g=e.commentId;return e.comments=h[g],[200,e]}),a.whenPUT(/\/posts(\/[0-9a-z]{24})/).respond(function(a,b,c){var d=b.replace("/posts","").split("/"),e=d[1];return f[e]=angular.fromJson(c),[200,{},{}]}),a.whenPOST("/posts").respond(function(a,c,e){var g=angular.fromJson(e),h=new d(b(),b(),g.title,g.text);return f[h.id]=h,[200,{},{}]}),a.whenDELETE(/\/posts(\/[0-9a-z]{24})/).respond(function(a,b){var c=b.replace("/posts","").split("/"),d=c[1];return delete f[d],[200,{},{}]}),a.whenPOST("/comments").respond(function(a,c,d){var f=angular.fromJson(d),g=new e(b(),f.parentId,f.postId,f.email,f.text);return h[g.postId][g.id]=g,[200,{},{}]}),a.whenDELETE(/\/comments(\/[0-9a-z]{24})/).respond(function(a,b){var d=b.replace("/comments","").split("/"),e=d[1];return c(e),[200,{},{}]}),a.whenGET(/^views\//).passThrough()}]);var table={7:{parent_id:2,id:7,children:{}},10:{parent_id:3,id:10,children:{}},1:{parent_id:0,id:1,children:{}},4:{parent_id:1,id:4,children:{}},5:{parent_id:1,id:5,children:{}},6:{parent_id:1,id:6,children:{}},2:{parent_id:0,id:2,children:{}},8:{parent_id:7,id:8,children:{}},9:{parent_id:8,id:9,children:{}},3:{parent_id:0,id:3,children:{}}},root={parent_id:null,id:0,children:{}},node_list={0:root};_.each(table,function(a,b){node_list[a.id]=a,node_list[a.parent_id].children[b]=node_list[a.id]});